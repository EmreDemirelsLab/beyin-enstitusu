<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Hedef Nesne Egzersizi | Göz Egzersizi</title>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --secondary-color: #7209b7;
            --success-color: #06d6a0;
            --danger-color: #ef476f;
            --warning-color: #ffd166;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
            --gray-color: #e9ecef;
            --gray-dark: #adb5bd;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: var(--dark-color);
            overscroll-behavior: none;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 10px;
            transform: scale(0.96);
            transform-origin: top center;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 10px 0;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        header h1 {
            margin: 0;
            font-weight: 600;
            font-size: 24px;
        }
        
        .exercise-info {
            background-color: white;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            color: #555;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .toolbar {
            background-color: white;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 12px;
            align-items: center;
            position: relative;
            z-index: 5;
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            background: var(--light-color);
            border: 1px solid var(--gray-color);
            border-radius: 6px;
            padding: 0;
            display: flex;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .dropdown-btn:hover, .dropdown-btn:active {
            background: var(--gray-color);
        }
        
        .dropdown-title {
            border-right: 1px solid var(--gray-color);
            padding: 8px 10px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .dropdown-arrow {
            padding: 8px;
            color: var(--primary-color);
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 160px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 6;
            border-radius: 6px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .dropdown-content a {
            color: var(--dark-color);
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            transition: background 0.2s ease;
        }
        
        .dropdown-content a:hover, .dropdown-content a:active {
            background-color: var(--gray-color);
            color: var(--primary-color);
        }
        
        .info-bar {
            background: linear-gradient(to right, var(--dark-color), #3a455c);
            color: white;
            height: 36px;
            line-height: 36px;
            display: flex;
            justify-content: space-between;
            border-radius: 8px;
            margin-bottom: 1px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
        }
        
        .info-text {
            padding: 0 15px;
            font-weight: 500;
        }
        
        .timer {
            background-color: var(--primary-color);
            color: white;
            padding: 0 20px;
            border-radius: 0 8px 8px 0;
            font-weight: bold;
            font-size: 15px;
        }
        
        .target-info {
            background-color: white;
            border-radius: 12px;
            padding: 10px;
            margin: 10px auto;
            text-align: center;
            font-size: 16px;
            max-width: 350px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            z-index: 3;
        }
        
        .target-info:active {
            transform: scale(0.98);
        }
        
        .target-symbol {
            font-size: 64px;
            margin: 10px 0;
            display: inline-block;
            color: black;
        }
        
        .exercise-area {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 460px;
            margin: 8px auto;
            background-color: white;
            border-radius: 12px;
            overflow: visible;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }
        
        .objects-container {
            position: absolute;
            top: 45%;
            left: 0;
            right: 0;
            min-height: 80px;
            max-height: 120px;
            margin-top: -40px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 0 10px;
        }
        
        .object {
            font-size: 54px;
            margin: 15px;
            line-height: 1;
        }
        
        .answer-buttons {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .answer-btn {
            padding: 12px 40px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            user-select: none;
            -webkit-user-select: none;
        }
        
        .answer-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .yes-btn {
            background-color: var(--success-color);
            color: white;
        }
        
        .no-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(rgba(43, 45, 66, 0.8), rgba(114, 9, 183, 0.8));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .start-button, .stop-button {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 5px;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .start-button:active, .stop-button:active {
            transform: translateY(3px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .stop-button {
            background: linear-gradient(to right, var(--danger-color), #d64161);
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 10px 20px;
            font-size: 16px;
            z-index: 5;
            display: none;
        }
        
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            line-height: 100px;
            text-align: center;
            background: white;
            font-size: 70px;
            color: var(--primary-color);
            border: 3px solid var(--primary-color);
            display: none;
            z-index: 20;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            font-weight: bold;
            pointer-events: none;
        }
        
        .completion-message {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            height: auto;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .completion-title {
            color: var(--dark-color);
            font-size: 28px;
            margin-top: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .result-stats {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: left;
            font-size: 15px;
        }
        
        .result-stats p {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .result-stats p span {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .progress-bar {
            height: 24px;
            background-color: var(--gray-color);
            border-radius: 12px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            text-align: center;
            line-height: 24px;
            color: white;
            font-weight: 600;
            transition: width 1s ease;
        }
        
        .restart-button {
            background: linear-gradient(to right, var(--success-color), #3cb371);
            color: white;
            border: none;
            padding: 12px 35px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s ease;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            user-select: none;
            -webkit-user-select: none;
        }
        
        .restart-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stats-container {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stats-container div {
            margin: 5px 0;
        }
        
        .stats-container span {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Mobil cihazlar için özel düzenlemeler */
        @media (max-width: 768px) {
            .objects-container {
                flex-wrap: wrap;
                height: auto;
                top: 40%;
                padding: 0 10px;
            }

            .stats-container {
                top: 10px;
                right: 10px;
                padding: 5px 8px;
                font-size: 10px;
                max-width: 120px;
                border-radius: 6px;
            }
            
            .stats-container div {
                margin: 2px 0;
            }
        }

            .object {
                font-size: 46px;
                margin: 10px;
            }

            .answer-buttons {
                bottom: 20px;
            }

            .exercise-area {
                padding-bottom: 8px;
            }
            

            .answer-btn {
                padding: 15px 40px;
                font-size: 18px;
                min-width: 120px;
            }
            
            /* Mobil için daha büyük dokunma alanları */
            .start-button, .stop-button, .restart-button {
                padding: 15px 40px;
                min-width: 200px;
                font-size: 18px;
            }
            
            .target-info {
                padding: 15px;
                margin: 15px auto;
            }
            
            .dropdown-content a {
                padding: 15px;
                font-size: 16px;
            }
            
            .dropdown-btn .dropdown-title,
            .dropdown-btn .dropdown-arrow {
                padding: 12px 15px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 500px) {
            .completion-message {
                padding: 15px;
                width: 85%;
            }
            
            .result-stats {
                padding: 10px;
                font-size: 14px;
            }
            
            .completion-title {
                font-size: 22px;
                margin-bottom: 15px;
            }
            
            .exercise-area {
                height: 400px;
            }
            
            .object {
                font-size: 40px;
                margin: 8px;
            }
        }
        .navbar {
    background: var(--primary-dark);
    padding: 15px 0;
    width: 100%;
    position: relative;
    z-index: 10;
}

.navbar .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.logo {
    color: white;
    font-size: 20px;
    font-weight: bold;
    text-decoration: none;
}

.back-button {
    color: white;
    text-decoration: none;
    padding: 8px 15px;
    border-radius: 5px;
    background: rgba(255,255,255,0.1);
    transition: background 0.3s;
}

.back-button:hover {
    background: rgba(255,255,255,0.2);
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hedef Nesne Egzersizi</h1>
        </header>
        
        <div class="exercise-info">
            Bu egzersiz, algılama ve görsel takip becerilerinizi geliştirmeyi amaçlar. 
            Size bir hedef nesne gösterilecek ve kısa sürelerle ekranda beliren nesneler arasında 
            bu hedef nesnenin olup olmadığını tespit etmeniz istenecek. 
            Hedefi gördüğünüzde EVET, görmediğinizde HAYIR butonuna basın.
            <br><br>
            <strong>Her 5 adımda bir nesne sayısı artacak ve egzersiz giderek zorlaşacaktır.</strong>
        </div>
        
        <div class="toolbar">
            <div class="dropdown">
                <button class="dropdown-btn" id="durationBtn">
                    <div class="dropdown-title" id="selectedDuration">1:00</div>
                    <div class="dropdown-arrow">▾</div>
                </button>
                <div id="durationDropdown" class="dropdown-content">
                    <a href="#" id="duration60">1:00</a>
                    <a href="#" id="duration120">2:00</a>
                    <a href="#" id="duration180">3:00</a>
                    <a href="#" id="duration240">4:00</a>
                    <a href="#" id="duration300">5:00</a>
                </div>
            </div>
            
            <div class="dropdown">
                <button class="dropdown-btn" id="levelBtn">
                    <div class="dropdown-title" id="selectedLevel">3. Seviye</div>
                    <div class="dropdown-arrow">▾</div>
                </button>
                <div id="levelDropdown" class="dropdown-content">
                    <a href="#" id="level1">1. Seviye (Kolay)</a>
                    <a href="#" id="level2">2. Seviye</a>
                    <a href="#" id="level3">3. Seviye (Orta)</a>
                    <a href="#" id="level4">4. Seviye</a>
                    <a href="#" id="level5">5. Seviye (Zor)</a>
                </div>
            </div>
        </div>
        
        <div class="info-bar">
            <span class="info-text">Hedef nesneyi bulun!</span>
            <span class="timer" id="timer">01:00</span>
        </div>
        
        <div class="target-info" id="targetInfo">
            <div>Bu şekli gördüğünüzde EVET'e basın:</div>
            <div class="target-symbol" id="targetSymbol">★</div>
        </div>
        
        <div class="exercise-area">
            <button class="stop-button" id="stopButton">Egzersizi Durdur</button>
            
            <div class="objects-container" id="objectsContainer">
                <!-- Nesneler JavaScript ile eklenecek -->
            </div>
            
            <div class="answer-buttons" id="answerButtons" style="display: none;">
                <button class="answer-btn yes-btn" id="yesButton">EVET</button>
                <button class="answer-btn no-btn" id="noButton">HAYIR</button>
            </div>
            
            <div class="feedback" id="feedback"></div>
            
            <div class="stats-container" id="statsContainer" style="display: none;">
                <div>Doğru: <span id="correctCount">0</span></div>
                <div>Yanlış: <span id="wrongCount">0</span></div>
                <div>Kaçırılan: <span id="missedCount">0</span></div>
                <div>Seviye: <span id="currentLevelDisplay">1</span></div>
                <div>Nesne Sayısı: <span id="currentObjectCountDisplay">4</span></div>
            </div>
            
            <div class="overlay" id="startOverlay">
                <button class="start-button" id="startButton">Egzersizi Başlat</button>
            </div>
            
            <div class="countdown" id="countdown">3</div>
            
            <div id="completionOverlay" class="overlay" style="display: none;">
                <div class="completion-message">
                    <h2 class="completion-title">Egzersiz Tamamlandı!</h2>
                    <div class="result-stats">
                        <p>Toplam Adım: <span id="totalSteps">0</span></p>
                        <p>Doğru: <span id="finalCorrect">0</span></p>
                        <p>Yanlış: <span id="finalWrong">0</span></p>
                        <p>Kaçırılan: <span id="finalMissed">0</span></p>
                        <p>Ulaşılan Seviye: <span id="finalLevel">1</span></p>
                        <p>Maksimum Nesne Sayısı: <span id="maxObjects">4</span></p>
                        <p>Başarı Yüzdesi:</p>
                        <div class="progress-bar">
                            <div class="progress-value" id="successRate">0%</div>
                        </div>
                    </div>
                    <button class="restart-button" id="restartButton">Yeni Egzersiz Başlat</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Kullanılabilecek semboller
        const semboller = [
            '★', '✦', '✚', '✖', '◆', '▲', '●', '■', '♦', '♣', '♠', '♥',
            '➤', '✈', '☼', '☂', '☯', '⚛', '⚡', '⚽', '♫', '✎', '✉', '☎'
        ];

        // Egzersiz ayarları
        let duration = 60;  // saniye
        let level = 3;
        let exerciseStarted = false;
        let targetSymbol = '★';
        let stepCount = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let missedCount = 0;
        let answerTimer;
        let currentStepHasTarget = false;
        
        // Progressif nesne sayısı için değişkenler
        let currentLevel = 1;
        let baseObjectCount = 4; // başlangıç nesne sayısı
        let maxLevel = 10; // maksimum seviye
        let objectIncreasePerLevel = 2; // her seviyede kaç nesne eklenecek
        
        // Zamanlayıcılar
        let exerciseTimer;
        let countdownTimer;
        let objectsTimer;
        let remainingTime = 60;
        
        // Zorluk seviyesine göre görüntülenme süreleri (ms)
        const displayDurations = [2000, 1600, 1400, 1200, 1000];
        
        // Mobil cihaz tespiti
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Array karıştırma fonksiyonu
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Sayfa yüklendiğinde çalışacak
        document.addEventListener('DOMContentLoaded', function() {
            // Event listener'ları ekle
            setupEventListeners();
            
            // Hedef nesneyi görünür yapmak için mesaj ekle
            addTargetInfoText();
            
            // Mobil cihaz optimizasyonları
            if (isMobile) {
                setupMobileOptimizations();
            }
            
            // Dokunma olayı sorununu düzelt
            preventTouchProblems();
        });
        
        // Tüm olay dinleyicileri ekle
        function setupEventListeners() {
            // Dropdown menüler
            document.getElementById('durationBtn').addEventListener('click', function() {
                toggleDropdown('durationDropdown');
            });
            
            document.getElementById('levelBtn').addEventListener('click', function() {
                toggleDropdown('levelDropdown');
            });
            
            // Süre seçenekleri
            document.getElementById('duration60').addEventListener('click', function(e) {
                e.preventDefault();
                setDuration(60);
            });
            
            document.getElementById('duration120').addEventListener('click', function(e) {
                e.preventDefault();
                setDuration(120);
            });
            
            document.getElementById('duration180').addEventListener('click', function(e) {
                e.preventDefault();
                setDuration(180);
            });
            
            document.getElementById('duration240').addEventListener('click', function(e) {
                e.preventDefault();
                setDuration(240);
            });
            
            document.getElementById('duration300').addEventListener('click', function(e) {
                e.preventDefault();
                setDuration(300);
            });
            
            // Seviye seçenekleri
            document.getElementById('level1').addEventListener('click', function(e) {
                e.preventDefault();
                setLevel(1);
            });
            
            document.getElementById('level2').addEventListener('click', function(e) {
                e.preventDefault();
                setLevel(2);
            });
            
            document.getElementById('level3').addEventListener('click', function(e) {
                e.preventDefault();
                setLevel(3);
            });
            
            document.getElementById('level4').addEventListener('click', function(e) {
                e.preventDefault();
                setLevel(4);
            });
            
            document.getElementById('level5').addEventListener('click', function(e) {
                e.preventDefault();
                setLevel(5);
            });
            
            // Butonlar
            document.getElementById('startButton').addEventListener('click', startExercise);
            document.getElementById('stopButton').addEventListener('click', stopExercise);
            document.getElementById('yesButton').addEventListener('click', answerYes);
            document.getElementById('noButton').addEventListener('click', answerNo);
            document.getElementById('restartButton').addEventListener('click', resetExercise);
            
            // Hedef bilgisi kutusuna tıklama
            document.getElementById('targetInfo').addEventListener('click', function() {
                showTargetSymbol();
            });
            
            // Dışarıya tıklandığında dropdown menüleri kapat
            document.addEventListener('click', function(event) {
                // Dropdown düğmeleri dışında bir yere tıklandıysa
                if (!event.target.closest('.dropdown-btn') && !event.target.closest('.dropdown-content')) {
                    // Tüm dropdown menüleri kapat
                    const dropdowns = document.getElementsByClassName('dropdown-content');
                    for (let i = 0; i < dropdowns.length; i++) {
                        dropdowns[i].style.display = 'none';
                    }
                }
            });
        }
        
        // Mobil cihazlar için ek optimizasyonlar
        function setupMobileOptimizations() {
            console.log("Mobil cihaz tespit edildi, dokunma olayları ekleniyor");
            
            // Dokunma olayları ekle
            document.getElementById('startButton').addEventListener('touchstart', function(e) {
                e.preventDefault();
                startExercise();
            });
            
            document.getElementById('stopButton').addEventListener('touchstart', function(e) {
                e.preventDefault();
                stopExercise();
            });
            
            document.getElementById('yesButton').addEventListener('touchstart', function(e) {
                e.preventDefault();
                answerYes();
            });
            
            document.getElementById('noButton').addEventListener('touchstart', function(e) {
                e.preventDefault();
                answerNo();
            });
            
            document.getElementById('restartButton').addEventListener('touchstart', function(e) {
                e.preventDefault();
                resetExercise();
            });
            
            document.getElementById('targetInfo').addEventListener('touchstart', function(e) {
                e.preventDefault();
                showTargetSymbol();
            });
        }
        
        // Dokunma sorunlarını önle
        function preventTouchProblems() {
            // Mobil sürükleme ve kaydırma sorunlarını önle
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.answer-btn') || e.target.closest('.target-info') || 
                    e.target.closest('.start-button') || e.target.closest('.stop-button') || 
                    e.target.closest('.restart-button')) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Çift dokunma yakınlaştırmasını engelle
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                const lastTouch = window.lastTouchEnd || now;
                const delta = now - lastTouch;
                if (delta < 300 && e.touches.length === 0) {
                    e.preventDefault();
                }
                window.lastTouchEnd = now;
            }, false);
        }
        
        // Hedef bilgisi metnini ekle
        function addTargetInfoText() {
            const targetContainer = document.getElementById("targetInfo");
            if (!document.querySelector(".target-info-text")) {
                const infoText = document.createElement("div");
                infoText.className = "target-info-text";
                infoText.innerHTML = "Hedefi görmek için tıklayın";
                infoText.style.fontSize = "12px";
                infoText.style.color = "#777";
                infoText.style.marginTop = "5px";
                targetContainer.appendChild(infoText);
            }
        }
        
        // Dropdown menüyü aç/kapat
        function toggleDropdown(id) {
            if (exerciseStarted) return;
            
            const dropdown = document.getElementById(id);
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            
            // Diğer açık dropdown'ları kapat
            const dropdowns = document.getElementsByClassName('dropdown-content');
            for (let i = 0; i < dropdowns.length; i++) {
                if (dropdowns[i].id !== id) {
                    dropdowns[i].style.display = 'none';
                }
            }
        }
        
        // Hedef sembolü göster (tıklama ile)
        function showTargetSymbol() {
            const targetSymbolElement = document.getElementById("targetSymbol");
            targetSymbolElement.style.visibility = "visible";
            
            // 4 saniye sonra tekrar gizle
            setTimeout(() => {
                targetSymbolElement.style.visibility = "hidden";
            }, 4000);
        }
        
        // Egzersiz süresini ayarla
        function setDuration(seconds) {
            duration = seconds;
            remainingTime = seconds;
            document.getElementById("selectedDuration").innerText = formatTime(seconds);
            document.getElementById("timer").innerText = formatTime(seconds);
            document.getElementById("durationDropdown").style.display = "none";
        }
        
        // Zorluk seviyesini ayarla
        function setLevel(newLevel) {
            level = newLevel;
            document.getElementById("selectedLevel").innerText = `${newLevel}. Seviye`;
            document.getElementById("levelDropdown").style.display = "none";
        }
        
        // Zamanı MM:SS formatında göster
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins < 10 ? '0' : ''}${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // Hedef sembolü belirle
        function setTargetSymbol() {
            // Rastgele bir sembol seç
            const randomIndex = Math.floor(Math.random() * semboller.length);
            targetSymbol = semboller[randomIndex];
            
            // Hedef sembolü göster
            document.getElementById("targetSymbol").innerText = targetSymbol;
        }
        
        // Hedef sembolünü göster ve sonra gizle
        function showTargetSymbolTemporarily() {
            // Hedef sembolünü içeren container'ı bul
            const targetContainer = document.getElementById("targetInfo");
            // Hedef sembolü bul
            const targetSymbolElement = document.getElementById("targetSymbol");
            
            // Başlangıçta hedef sembolü göster
            targetContainer.style.display = "block";
            targetSymbolElement.style.visibility = "visible";
            
            // 5 saniye sonra sadece sembolü gizle, container'ı değil
            setTimeout(() => {
                targetSymbolElement.style.visibility = "hidden";
            }, 5000);
        }
        
        // Nesneleri oluştur ve göster
        function createAndShowObjects() {
            // Nesneleri içeren container
            const container = document.getElementById('objectsContainer');
            container.innerHTML = '';
            
            // Mevcut seviyeye göre nesne sayısını hesapla
            const currentObjectCount = baseObjectCount + (currentLevel - 1) * objectIncreasePerLevel;
            
            // İstatistik ekranını güncelle
            document.getElementById('currentLevelDisplay').innerText = currentLevel;
            document.getElementById('currentObjectCountDisplay').innerText = currentObjectCount;
            
            // Hedefin bu adımda olup olmayacağını belirle (%50 olasılık)
            currentStepHasTarget = Math.random() < 0.5;
            
            // Nesneleri oluştur
            const objectsToShow = [];
            
            // Eğer hedef bu adımda olacaksa, listeye ekle
            if (currentStepHasTarget) {
                objectsToShow.push(targetSymbol);
            }
            
            // Diğer nesneleri seç
            const otherSymbols = semboller.filter(s => s !== targetSymbol);
            const remainingCount = currentObjectCount - (currentStepHasTarget ? 1 : 0);
            
            for (let i = 0; i < remainingCount; i++) {
                const randomIndex = Math.floor(Math.random() * otherSymbols.length);
                objectsToShow.push(otherSymbols[randomIndex]);
            }
            
            // Nesnelerin sırasını karıştır
            shuffleArray(objectsToShow);
            
            // Nesneleri container'a ekle
            for (let i = 0; i < objectsToShow.length; i++) {
                const objectElement = document.createElement('div');
                objectElement.className = 'object';
                objectElement.innerText = objectsToShow[i];
                container.appendChild(objectElement);
            }
            
            // Nesneleri göster
            const objects = document.getElementsByClassName('object');
            for (let i = 0; i < objects.length; i++) {
                objects[i].style.display = 'block';
            }
            
            // Cevap butonlarını göster
            document.getElementById('answerButtons').style.display = 'flex';
            
            // Belirli bir süre sonra nesneleri gizle (zorluk seviyesine göre)
            setTimeout(() => {
                if (exerciseStarted) {
                    // Nesneleri gizle
                    const objects = document.getElementsByClassName('object');
                    for (let i = 0; i < objects.length; i++) {
                        objects[i].style.display = 'none';
                    }
                }
            }, displayDurations[level - 1]);
            
            // Cevap zamanını başlat (2 saniye)
            answerTimer = setTimeout(() => {
                // Süre doldu, cevap verilmedi
                if (!exerciseStarted) return; // Exercise ended before timeout
                
                missedCount++;
                document.getElementById('missedCount').innerText = missedCount;
                showFeedback('Kaçırdın!', '#ffd166');
                nextStep();
            }, 2000);
        }
        
        // Nesneleri gizle
        function hideObjects() {
            const objects = document.getElementsByClassName('object');
            for (let i = 0; i < objects.length; i++) {
                objects[i].style.display = 'none';
            }
            
            // Cevap butonlarını gizle
            document.getElementById('answerButtons').style.display = 'none';
        }
        
        // "EVET" cevabı
        function answerYes() {
            clearTimeout(answerTimer);
            
            if (currentStepHasTarget) {
                // Doğru cevap
                correctCount++;
                document.getElementById('correctCount').innerText = correctCount;
                showFeedback('Doğru bildin!', '#06d6a0');
            } else {
                // Yanlış cevap
                wrongCount++;
                document.getElementById('wrongCount').innerText = wrongCount;
                showFeedback('Yanlış!', '#ef476f');
            }
            
            nextStep();
        }
        
        // "HAYIR" cevabı
        function answerNo() {
            clearTimeout(answerTimer);
            
            if (!currentStepHasTarget) {
                // Doğru cevap
                correctCount++;
                document.getElementById('correctCount').innerText = correctCount;
                showFeedback('Doğru bildin!', '#06d6a0');
            } else {
                // Yanlış cevap
                wrongCount++;
                document.getElementById('wrongCount').innerText = wrongCount;
                showFeedback('Yanlış!', '#ef476f');
            }
            
            nextStep();
        }
        
        // Geri bildirim göster
        function showFeedback(message, color) {
            const feedback = document.getElementById('feedback');
            feedback.innerText = message;
            feedback.style.backgroundColor = color;
            feedback.style.opacity = 1;
            
            setTimeout(() => {
                feedback.style.opacity = 0;
            }, 1000);
        }
        
        // Sonraki adıma geç
        function nextStep() {
            stepCount++;
            hideObjects();
            
            // Her 5 adımda bir hedef nesneyi değiştir ve seviyeyi artır
            if (stepCount % 5 === 0) {
                setTargetSymbol();
                showFeedback('Yeni hedef!', '#4361ee');
                
                // Yeni hedefi 2 saniye göster
                const targetSymbolElement = document.getElementById("targetSymbol");
                document.getElementById("targetInfo").style.display = "block";
                targetSymbolElement.style.visibility = "visible";
                
                setTimeout(() => {
                    targetSymbolElement.style.visibility = "hidden";
                }, 2000);
                
                // Her 5 adımda seviyeyi artır (maksimum seviyeye kadar)
                if (currentLevel < maxLevel) {
                    currentLevel++;
                    const currentObjectCount = baseObjectCount + (currentLevel - 1) * objectIncreasePerLevel;
                    showFeedback(`Seviye ${currentLevel}! Nesne sayısı: ${currentObjectCount}`, '#06d6a0');
                }
            }
            
            // Kısa bir bekleme süresi sonra yeni nesneleri göster
            setTimeout(() => {
                // Egzersiz hala devam ediyorsa yeni nesneleri göster
                if (exerciseStarted) {
                    createAndShowObjects();
                }
            }, 1200);
        }
        
        // Egzersizi başlat
        function startExercise() {
            // Değişkenleri sıfırla
            exerciseStarted = true;
            stepCount = 0;
            correctCount = 0;
            wrongCount = 0;
            missedCount = 0;
            remainingTime = duration;
            currentLevel = 1; // Seviyeyi sıfırla
            
            // İstatistikleri sıfırla ve göster
            document.getElementById('correctCount').innerText = '0';
            document.getElementById('wrongCount').innerText = '0';
            document.getElementById('missedCount').innerText = '0';
            document.getElementById('currentLevelDisplay').innerText = '1';
            document.getElementById('currentObjectCountDisplay').innerText = baseObjectCount.toString();
            document.getElementById('statsContainer').style.display = 'block';
            
            // Durdurma butonunu göster
            document.getElementById('stopButton').style.display = 'block';
            
            // Başlat overlay'i gizle
            document.getElementById('startOverlay').style.display = 'none';
            
            // Hedef sembolü belirle ve geçici olarak göster
            setTargetSymbol();
            showTargetSymbolTemporarily();
            
            // Başlangıçta tüm nesneleri gizle
            hideObjects();
            
            // Geri sayım başlat
            const countdownEl = document.getElementById('countdown');
            countdownEl.style.display = 'block';
            let countdownValue = 3;
            countdownEl.innerText = countdownValue;
            
            countdownTimer = setInterval(() => {
                countdownValue--;
                countdownEl.innerText = countdownValue;
                
                if (countdownValue <= 0) {
                    clearInterval(countdownTimer);
                    countdownEl.style.display = 'none';
                    
                    // Nesneleri göstermeye başla
                    createAndShowObjects();
                    
                    // Zamanlayıcıyı başlat
                    startTimer();
                }
            }, 1000);
        }
        
        // Egzersizi durdur
        function stopExercise() {
            // Egzersiz başlamadıysa işlem yapma
            if (!exerciseStarted) return;
            
            // Egzersizi sonlandır
            endExercise();
            
            // Geri bildirim göster
            showFeedback('Egzersiz durduruldu', '#4361ee');
        }
        
        // Zamanlayıcıyı başlat
        function startTimer() {
            exerciseTimer = setInterval(() => {
                remainingTime--;
                document.getElementById('timer').innerText = formatTime(remainingTime);
                
                if (remainingTime <= 0) {
                    endExercise();
                }
            }, 1000);
        }
        
        // Egzersizi sonlandır
        function endExercise() {
            // Egzersiz durumunu güncelle
            exerciseStarted = false;
            
            // Zamanlayıcıları temizle
            clearInterval(exerciseTimer);
            clearTimeout(answerTimer);
            clearInterval(countdownTimer);
            
            // Nesneleri ve cevap butonlarını gizle
            hideObjects();
            
            // İstatistik kutusunu gizle
            document.getElementById('statsContainer').style.display = 'none';
            
            // Durdurma butonunu gizle
            document.getElementById('stopButton').style.display = 'none';
            
            // Sonuç istatistiklerini hazırla
            const totalSteps = stepCount;
            const successRate = totalSteps > 0 ? Math.round((correctCount / totalSteps) * 100) : 0;
            const finalLevel = currentLevel;
            const maxObjectCount = baseObjectCount + (finalLevel - 1) * objectIncreasePerLevel;
            
            // Sonuç değerlerini güncelle
            document.getElementById('totalSteps').innerText = totalSteps;
            document.getElementById('finalCorrect').innerText = correctCount;
            document.getElementById('finalWrong').innerText = wrongCount;
            document.getElementById('finalMissed').innerText = missedCount;
            document.getElementById('finalLevel').innerText = finalLevel;
            document.getElementById('maxObjects').innerText = maxObjectCount;
            document.getElementById('successRate').innerText = `${successRate}%`;
            document.getElementById('successRate').style.width = `${successRate}%`;
            
            // Tamamlama overlay'ini göster
            document.getElementById('completionOverlay').style.display = 'flex';
        }
        
        // Egzersizi sıfırla
        function resetExercise() {
            // Tamamlama overlay'ini gizle
            document.getElementById('completionOverlay').style.display = 'none';
            
            // Başlat overlay'ini göster
            document.getElementById('startOverlay').style.display = 'flex';
            
            // Zamanı sıfırla
            document.getElementById('timer').innerText = formatTime(duration);
            
            // Değişkenleri sıfırla
            remainingTime = duration;
            stepCount = 0;
            correctCount = 0;
            wrongCount = 0;
            missedCount = 0;
            currentLevel = 1;
        }
    </script>
</body>
</html>
